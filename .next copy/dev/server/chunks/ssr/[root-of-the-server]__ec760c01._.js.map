{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mateo/Documents/GitHub/aevum_web/src/lib/db/schema.ts"],"sourcesContent":["import { pgTable, text, timestamp, integer, boolean, jsonb, varchar, serial } from \"drizzle-orm/pg-core\";\r\nimport { relations } from \"drizzle-orm\";\r\n\r\nexport const users = pgTable(\"users\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  clerkId: varchar(\"clerk_id\", { length: 255 }).notNull().unique(),\r\n  minecraftUsername: varchar(\"minecraft_username\", { length: 16 }),\r\n  minecraftUuid: varchar(\"minecraft_uuid\", { length: 36 }).unique(), // New: Unique UUID\r\n  verificationCode: varchar(\"verification_code\", { length: 8 }), // New: Code for /link <code\r\n  isVerified: boolean(\"is_verified\").default(false).notNull(), // New: Verification status\r\n  email: varchar(\"email\", { length: 255 }).notNull(),\r\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\r\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\r\n  isWhitelisted: boolean(\"is_whitelisted\").default(false).notNull(),\r\n  isAdmin: boolean(\"is_admin\").default(false).notNull(),\r\n});\r\n\r\nexport const playerApplications = pgTable(\"player_applications\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  userId: integer(\"user_id\").references(() => users.id),\r\n  minecraftUsername: varchar(\"minecraft_username\", { length: 16 }).notNull(),\r\n  age: integer(\"age\"),\r\n  experience: text(\"experience\"),\r\n  whyJoin: text(\"why_join\").notNull(),\r\n  status: varchar(\"status\", { length: 50 }).default(\"pending\").notNull(), // pending, approved, rejected\r\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\r\n  reviewedAt: timestamp(\"reviewed_at\"),\r\n  reviewedBy: integer(\"reviewed_by\").references(() => users.id),\r\n});\r\n\r\nexport const serverStatistics = pgTable(\"server_statistics\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  date: timestamp(\"date\").defaultNow().notNull(),\r\n  playerCount: integer(\"player_count\").default(0).notNull(),\r\n  maxPlayers: integer(\"max_players\").default(100).notNull(),\r\n  uptime: integer(\"uptime\").default(0).notNull(), // in seconds\r\n  tps: integer(\"tps\").default(20).notNull(),\r\n  ping: integer(\"ping\").default(0).notNull(),\r\n});\r\n\r\nexport const leaderboardEntries = pgTable(\"leaderboard_entries\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  userId: integer(\"user_id\").references(() => users.id),\r\n  minecraftUsername: varchar(\"minecraft_username\", { length: 16 }).notNull(),\r\n  kills: integer(\"kills\").default(0).notNull(),\r\n  deaths: integer(\"deaths\").default(0).notNull(),\r\n  kdr: integer(\"kdr\").default(0).notNull(), // kills/deaths ratio * 100\r\n  wealth: integer(\"wealth\").default(0).notNull(),\r\n  playtime: integer(\"playtime\").default(0).notNull(), // in minutes\r\n  lastUpdated: timestamp(\"last_updated\").defaultNow().notNull(),\r\n});\r\n\r\nexport const announcements = pgTable(\"announcements\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  title: varchar(\"title\", { length: 255 }).notNull(),\r\n  content: text(\"content\").notNull(),\r\n  authorId: integer(\"author_id\").references(() => users.id).notNull(),\r\n  isPinned: boolean(\"is_pinned\").default(false).notNull(),\r\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\r\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\r\n});\r\n\r\nexport const events = pgTable(\"events\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  title: varchar(\"title\", { length: 255 }).notNull(),\r\n  description: text(\"description\"),\r\n  eventType: varchar(\"event_type\", { length: 50 }).notNull(), // tournament, smp_event, community\r\n  startDate: timestamp(\"start_date\").notNull(),\r\n  endDate: timestamp(\"end_date\"),\r\n  location: varchar(\"location\", { length: 255 }),\r\n  maxParticipants: integer(\"max_participants\"),\r\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\r\n  createdBy: integer(\"created_by\").references(() => users.id).notNull(),\r\n});\r\n\r\nexport const waitlistSignups = pgTable(\"waitlist_signups\", {\r\n  id: serial(\"id\").primaryKey(),\r\n  email: varchar(\"email\", { length: 255 }).notNull(),\r\n  minecraftUsername: varchar(\"minecraft_username\", { length: 16 }),\r\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\r\n  notified: boolean(\"notified\").default(false).notNull(),\r\n});\r\n\r\n// Relations\r\nexport const usersRelations = relations(users, ({ many }) => ({\r\n  applications: many(playerApplications),\r\n  leaderboardEntries: many(leaderboardEntries),\r\n  announcements: many(announcements),\r\n}));\r\n\r\nexport const playerApplicationsRelations = relations(playerApplications, ({ one }) => ({\r\n  user: one(users, {\r\n    fields: [playerApplications.userId],\r\n    references: [users.id],\r\n  }),\r\n  reviewer: one(users, {\r\n    fields: [playerApplications.reviewedBy],\r\n    references: [users.id],\r\n  }),\r\n}));"],"names":[],"mappings":"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"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mateo/Documents/GitHub/aevum_web/src/lib/db/index.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/neon-serverless\";\r\nimport * as schema from \"./schema\";\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\"DATABASE_URL is not set\");\r\n}\r\n\r\n// Pass the connection string directly to drizzle\r\nexport const db = drizzle(process.env.DATABASE_URL, { schema });"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAGO,MAAM,KAAK,IAAA,yKAAO,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mateo/Documents/GitHub/aevum_web/src/app/dashboard/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { auth, currentUser } from \"@clerk/nextjs/server\";\r\nimport { db } from \"@/lib/db\";\r\nimport { users, playerApplications } from \"@/lib/db/schema\";\r\nimport { eq } from \"drizzle-orm\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nexport async function getDashboardData() {\r\n  const { userId } = await auth();\r\n  if (!userId) return null;\r\n\r\n  // Get user from DB\r\n  let user = await db.query.users.findFirst({\r\n    where: eq(users.clerkId, userId),\r\n  });\r\n\r\n  // If user doesn't exist in our DB yet but is logged in (should be handled by webhook/middleware, but for safety),\r\n  // we could create them or just return null. For now, assuming user exists or we create on the fly if critical.\r\n  if (!user) {\r\n    // Attempt to sync from Clerk if missing (optional self-repair)\r\n    const clerkUser = await currentUser();\r\n    if (clerkUser) {\r\n        const [newUser] = await db.insert(users).values({\r\n            clerkId: userId,\r\n            email: clerkUser.emailAddresses[0]?.emailAddress || \"\",\r\n            minecraftUsername: null,\r\n        }).returning();\r\n        user = newUser;\r\n    } else {\r\n        return null;\r\n    }\r\n  }\r\n\r\n  // Get application status\r\n  const application = await db.query.playerApplications.findFirst({\r\n    where: eq(playerApplications.userId, user.id),\r\n  });\r\n\r\n  return {\r\n    user,\r\n    application,\r\n  };\r\n}\r\n\r\nexport async function updateMinecraftUsername(username: string) {\r\n  const { userId } = await auth();\r\n  if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n  const cleanUsername = username.trim();\r\n  \r\n  // Basic validation\r\n  if (cleanUsername.length < 3 || cleanUsername.length > 16) {\r\n    throw new Error(\"Username must be between 3 and 16 characters\");\r\n  }\r\n\r\n  if (!/^[a-zA-Z0-9_]+$/.test(cleanUsername)) {\r\n    throw new Error(\"Username can only contain letters, numbers, and underscores\");\r\n  }\r\n\r\n  // Update user\r\n  await db.update(users)\r\n    .set({ minecraftUsername: cleanUsername })\r\n    .where(eq(users.clerkId, userId));\r\n\r\n  revalidatePath(\"/dashboard\");\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteMinecraftUsername() {\r\n  const { userId } = await auth();\r\n  if (!userId) throw new Error(\"Unauthorized\");\r\n\r\n  await db.update(users)\r\n    .set({ minecraftUsername: null })\r\n    .where(eq(users.clerkId, userId));\r\n\r\n  revalidatePath(\"/dashboard\");\r\n  return { success: true };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,eAAe;IACpB,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,2LAAI;IAC7B,IAAI,CAAC,QAAQ,OAAO;IAEpB,mBAAmB;IACnB,IAAI,OAAO,MAAM,+HAAE,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;QACxC,OAAO,IAAA,wKAAE,EAAC,mIAAK,CAAC,OAAO,EAAE;IAC3B;IAEA,kHAAkH;IAClH,+GAA+G;IAC/G,IAAI,CAAC,MAAM;QACT,+DAA+D;QAC/D,MAAM,YAAY,MAAM,IAAA,yMAAW;QACnC,IAAI,WAAW;YACX,MAAM,CAAC,QAAQ,GAAG,MAAM,+HAAE,CAAC,MAAM,CAAC,mIAAK,EAAE,MAAM,CAAC;gBAC5C,SAAS;gBACT,OAAO,UAAU,cAAc,CAAC,EAAE,EAAE,gBAAgB;gBACpD,mBAAmB;YACvB,GAAG,SAAS;YACZ,OAAO;QACX,OAAO;YACH,OAAO;QACX;IACF;IAEA,yBAAyB;IACzB,MAAM,cAAc,MAAM,+HAAE,CAAC,KAAK,CAAC,kBAAkB,CAAC,SAAS,CAAC;QAC9D,OAAO,IAAA,wKAAE,EAAC,gJAAkB,CAAC,MAAM,EAAE,KAAK,EAAE;IAC9C;IAEA,OAAO;QACL;QACA;IACF;AACF;AAEO,eAAe,wBAAwB,QAAgB;IAC5D,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,2LAAI;IAC7B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAE7B,MAAM,gBAAgB,SAAS,IAAI;IAEnC,mBAAmB;IACnB,IAAI,cAAc,MAAM,GAAG,KAAK,cAAc,MAAM,GAAG,IAAI;QACzD,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,kBAAkB,IAAI,CAAC,gBAAgB;QAC1C,MAAM,IAAI,MAAM;IAClB;IAEA,cAAc;IACd,MAAM,+HAAE,CAAC,MAAM,CAAC,mIAAK,EAClB,GAAG,CAAC;QAAE,mBAAmB;IAAc,GACvC,KAAK,CAAC,IAAA,wKAAE,EAAC,mIAAK,CAAC,OAAO,EAAE;IAE3B,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe;IACpB,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,2LAAI;IAC7B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAE7B,MAAM,+HAAE,CAAC,MAAM,CAAC,mIAAK,EAClB,GAAG,CAAC;QAAE,mBAAmB;IAAK,GAC9B,KAAK,CAAC,IAAA,wKAAE,EAAC,mIAAK,CAAC,OAAO,EAAE;IAE3B,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;;;IAvEsB;IAqCA;IAwBA;;AA7DA,+OAAA;AAqCA,+OAAA;AAwBA,+OAAA"}}]
}